<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<ProxyEndpoint name="Marriot-SwapTokens-ProxyProxyEndpoint">
   <Description>Marriot-SwapTokens-Proxy</Description>
   <FaultRules>
   </FaultRules>
   <DefaultFaultRule name="All">
      <AlwaysEnforce>true</AlwaysEnforce>
      <Step>
         <Name>SF-DefaultFaultCallout</Name>
      </Step>
      <Step>
         <Name>SF-Noname-Security</Name>
      </Step>
      <AlwaysEnforce>true</AlwaysEnforce>
   </DefaultFaultRule>
   <PreFlow name="PreFlow">
      <Request>
         <Step>
            <Name>SF-Noname-Security</Name>
         </Step>
      </Request>
      <Response>
      </Response>
   </PreFlow>
   <Flows>
      <Flow name="WrongAccept">
         <Description/>
         <Request>
            <Step>
               <Name>SF-Proxy-Current-Flow-Name</Name>
            </Step>
            <Step>
               <Name>cf-Fault-Unsupported-AcceptType</Name>
            </Step>
         </Request>
         <Response/>
         <Condition>(log.proxyVerb != "OPTIONS") and (!(log.Accept JavaRegex "(text\/xml)(;.*)|(.*;)(text\/xml)(;.*)|text\/xml|(.*;)(text\/xml)|(application\/xml)(;.*)|(.*;)(application\/xml)(;.*)|application\/xml|(.*;)(application\/xml)|(application\/json)(;.*)|(.*;)(application\/json)(;.*)|application\/json|(.*;)(application\/json)"))</Condition>
      </Flow>
      <Flow name="WrongContentType">
         <Description/>
         <Request>
            <Step>
               <Name>SF-Proxy-Current-Flow-Name</Name>
            </Step>
            <Step>
               <Name>cf-Fault-Unsupported-ContentType</Name>
            </Step>
         </Request>
         <Response/>
         <Condition>(log.proxyVerb != "OPTIONS") and ((!(request.content = "")) and (!(request.content is null)) and !(log.Content-Type JavaRegex "(text\/xml)(;.*)|(.*;)(text\/xml)(;.*)|text\/xml|(.*;)(text\/xml)|(application\/xml)(;.*)|(.*;)(application\/xml)(;.*)|application\/xml|(.*;)(application\/xml)|(application\/json)(;.*)|(.*;)(application\/json)(;.*)|application\/json|(.*;)(application\/json)"))</Condition>
      </Flow>
      <Flow name="products-marriott">
         <Request>
            <Step>
               <Name>cf-Assign-Routing-Variables-products-marriott</Name>
            </Step>
         </Request>
         <Response>
         </Response>
         <Condition>(proxy.pathsuffix MatchesPath &quot;/{membershipNumber}/products/marriott&quot;) and (request.verb= &quot;POST&quot;)</Condition>
      </Flow>
      <Flow name="swap-tokens">
         <Request>
            <Step>
               <Name>cf-Assign-Routing-Variables-swap-tokens</Name>
            </Step>
         </Request>
         <Response>
         </Response>
         <Condition>(proxy.pathsuffix MatchesPath &quot;/{memberIdentifier}/swaptokens&quot;) and (request.verb= &quot;POST&quot;)</Condition>
      </Flow>
      <Flow name="unknown-resource">
         <Request>
            <Step>
               <Name>cf-Unknown-Resource</Name>
            </Step>
         </Request>
         <Response/>
      </Flow>
   </Flows>
   <PostFlow name="PostFlow">
      <Request></Request>
      <Response>
         <Step>
            <Name>SF-Noname-Security</Name>
         </Step>
      </Response>
   </PostFlow>
   <PostClientFlow>
        <Request/>
        <Response>
            <Step>
                <Name>SF-Noname-Security</Name>
            </Step>
        </Response>
    </PostClientFlow>
   <HTTPProxyConnection>
      <BasePath>/loyalty/members/v2/profiles</BasePath>
      <VirtualHost>default</VirtualHost>
      <VirtualHost>secure</VirtualHost>
   </HTTPProxyConnection>
   <RouteRule name="NoRoute">
        <Condition>(request.verb == "OPTIONS")</Condition>
   </RouteRule>
   <RouteRule name="Marriot-SwapTokens-Target">
      <Condition>(target.route.service = &quot;Marriot-SwapTokens-Target&quot;)</Condition>
      <TargetEndpoint>Marriot-SwapTokens-Target</TargetEndpoint>
   </RouteRule>
</ProxyEndpoint>
